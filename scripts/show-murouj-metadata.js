import { createClient } from '@supabase/supabase-js'
import dotenv from 'dotenv'
import { fileURLToPath } from 'url'
import { dirname, join } from 'path'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

dotenv.config({ path: join(__dirname, '..', '.env.local') })

const supabaseUrl = process.env.SUPABASE_URL
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY
const supabase = createClient(supabaseUrl, supabaseServiceKey)

async function showMuroujMetadata() {
  // Get Murouj attraction
  const { data: attraction } = await supabase
    .from('attractions')
    .select('id, name, hero_image')
    .eq('slug', 'murouj-food-complex-subhan-area')
    .single()

  console.log('â•'.repeat(80))
  console.log(`ğŸ›ï¸  ${attraction.name}`)
  console.log('â•'.repeat(80))
  console.log('')

  // Get images with updated metadata
  const { data: images } = await supabase
    .from('attraction_images')
    .select('*')
    .eq('attraction_id', attraction.id)
    .order('display_order')

  console.log(`ğŸ“¸ Total Images: ${images.length}`)
  console.log(`ğŸŒŸ Hero Image URL: ${attraction.hero_image}`)
  console.log('')

  images.forEach((img, i) => {
    console.log(`â”`.repeat(80))
    console.log(`Image ${i + 1} of ${images.length}${img.is_hero ? ' â­ HERO' : ''}`)
    console.log(`â”`.repeat(80))
    console.log('')
    console.log(`ğŸ“ URL: ${img.url}`)
    console.log(`ğŸ“ Alt Text: "${img.alt_text}"`)
    console.log(`ğŸ“‹ Title: "${img.title}"`)
    console.log(`ğŸ“„ Description: "${img.description}"`)
    console.log(`ğŸ·ï¸  Type: ${img.type}`)
    console.log(`ğŸ¯ Hero Score: ${img.metadata?.hero_score || 'N/A'}/100`)
    console.log(`ğŸ’¬ Hero Reason: ${img.metadata?.hero_reason || 'N/A'}`)
    console.log(`ğŸ·ï¸  Classification: ${img.metadata?.content_classification?.join(', ') || 'N/A'}`)
    console.log(`ğŸ¨ Abstract Art: ${img.metadata?.is_abstract_art ? 'Yes' : 'No'}`)
    console.log(`âœ… Shows Attraction: ${img.metadata?.shows_actual_attraction ? 'Yes' : 'No'}`)
    console.log('')
  })

  console.log('â•'.repeat(80))
  console.log('âœ¨ All metadata generated by OpenAI GPT-4o Vision API')
  console.log('â•'.repeat(80))
}

showMuroujMetadata().catch(console.error)
